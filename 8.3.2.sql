--GROUP BY 절에 기재한 칼럼에 NULL 값이 존재할 경우 NULL 값이 결과집합에 포함된다.
--8-27 실습환경 구성
CREATE TABLE TB_EMP_8_3_4
(
  EMP_NO CHAR(10)
, EMP_NM VARCHAR2(20) NULL
, CUR_SAL NUMBER(15) NOT NULL
, DEPT_CD CHAR(6) NULL
, CONSTRAINT PK_TB_EMP_8_3_4 PRIMARY KEY(EMP_NO)
)
;

INSERT INTO TB_EMP_8_3_4 VALUES('1000000001','이부장',70000000,'D00001');
INSERT INTO TB_EMP_8_3_4 VALUES('1000000002','김팀장',65000000,'D00001');
INSERT INTO TB_EMP_8_3_4 VALUES('1000000003','박과장',55000000,'D00002');
INSERT INTO TB_EMP_8_3_4 VALUES('1000000004','최대리',45000000,'D00002');
INSERT INTO TB_EMP_8_3_4 VALUES('1000000005','최임시',35000000,NULL);
INSERT INTO TB_EMP_8_3_4 VALUES('1000000006','손인턴',25000000,NULL);

SELECT * FROM TB_EMP_8_3_4 ;

--8-28 GROUP BY의 사용
SELECT NVL(DEPT_CD, '[NULL]') AS DEPT_CD
     , TRUNC(AVG(CUR_SAL)) AS CUR_SAL_AVG
  FROM TB_EMP_8_3_4 
 GROUP BY DEPT_CD
 ORDER BY DEPT_CD
;
/*
DEPT_CD|CUR_SAL_AVG|
-------+-----------+
D00001 |   67500000|
D00002 |   50000000|
[NULL] |   30000000|
*/
--NULL도 GROUP BY 집계 대상에 포함됨


--GROUP BY의 결과가 공집합인 경우 MAX 함수를 써도 공집합이 출력된다.
--8-29 실습환경 구성
CREATE TABLE TB_ORD_8_3_5
( 
  ORD_NO CHAR(10)
, ORD_DE CHAR(8)
, ORD_AMT NUMBER
, ADD_AMT NUMBER
, ORD_NM CHAR(6)
);

INSERT INTO TB_ORD_8_3_5 VALUES('0000000001','20200101',500,50,'202001');

--8-30 공집합이 나오는 SELECT문
SELECT ORD_AMT
  FROM TB_ORD_8_3_5
 WHERE ORD_NM = '202010'
;

--8-31 집계 함수로 감싸서 공집합이 나오는 것을 방지
SELECT NVL(MAX(ORD_AMT),0) ORD_AMT_MAX
  FROM TB_ORD_8_3_5
 WHERE ORD_NM = '202010'
;

--8-32 GROUP BY를 추가
SELECT NVL(MAX(ORD_AMT),0) AS ORD_AMT_MAX
  FROM TB_ORD_8_3_5
 WHERE ORD_NM = '202010'
 GROUP BY ORD_NM 
;
--GROUP BY 대상 결과 행이 없어서 공집합 출력